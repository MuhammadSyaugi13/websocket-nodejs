<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65" crossorigin="anonymous">

    <title>rt chat</title>
</head>

<body>
    <div class="">
        <!-- join -->
        <div id="joinContainer" class="container w-50 border mt-5" style="height: auto;">
            <h3>real time chat - <%= title  %></h3>
            <form id="login" action="">
                <button id="joinButton" type="submit" class="btn btn-danger w-100 my-4">yuk join</button>
            </form>
        </div>
        <!-- ./ join -->

        <!-- chat -->
        <div id="chatContainer" class="container w-50 border mt-5" style="height: auto;">
            <h3>real time chat - <%= title %>
            </h3>
            <form id="chat" action="">

                <div id="messageList" class="message-list border border-2 my-4" style="height: 280px;"></div>

                <input id="message" type="text" name="" class="w-100 form-control">
                <button id="kirimPesan" type="submit" class="btn btn-danger w-100 my-4">kirim pesan</button>
            </form>
        </div>
        <!-- ./ chat -->

    </div>



    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4"
        crossorigin="anonymous"></script>

    <script src="/socket.io/socket.io.js"></script>

    <script>
        const socket = io()
        const joinContainer = document.getElementById('joinContainer')
        const messageList = document.getElementById('messageList')
        const kirimPesan = document.getElementById('kirimPesan')
        const message = document.getElementById('message')
        const chatContainer = document.getElementById('chatContainer')
        chatContainer.style.display = "none"
        
        joinButton.addEventListener("click", (e) => {
            e.preventDefault()
            chatContainer.style.display = "block"
            joinContainer.style.display = "none"
        })
        
        kirimPesan.addEventListener("click", (e) => {
            e.preventDefault()
            if(message.value){
                console.log('pesan diketik....');
                socket.emit("message", message.value)
                let chatList = document.createElement("p")
                chatList.style.fontSize = "24px"
                chatList.textContent = message.value
                messageList.appendChild(chatList)

            }

            message.value = ''
        })

        socket.on("message", (data) => {
            let broadcast = document.createElement("p")
            broadcast.style.fontSize = "24px"
            broadcast.textContent = data
            messageList.appendChild(broadcast)
        })


    </script>


</body>

</html>